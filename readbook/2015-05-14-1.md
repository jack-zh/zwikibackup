tags: read
title: 《Ubuntu Server 最佳方案（第2版）》-目录

## 第1 篇 拥抱Ubuntu Server 


### 第1 章 敲开Linux Server 的大门 2 

	1.1 Linux 到底是什么 2 
	1.2 为何选Linux，不选Windows 3 
	1.2.1 Linux 可以定制 4 
	1.2.2 Linux 比Windows 稳定 4 
	1.2.3 Linux 比Windows 响应快 5 
	1.2.4 Linux 比Windows 安全 5 
	1.2.5 Linux 不用花钱买 6 
	1.2.6 Linux 更适合远程管理 6 
	1.3 学习Linux 的终南捷径 7 
	1.3.1 兴趣、试验 7 
	1.3.2 真正的捷径——LFS 7 
	1.4 选择哪个Linux 发行版 8 
	1.4.1 关于Arch 和Gentoo 9 
	1.4.2 关于Red Hat、CentOS和Fedora 9 
	1.4.3 Debian 不错 10 
	1.4.4 推荐使用Ubuntu Server 11 
	1.5 应该买什么样的服务器 12 
	1.5.1 架构设计 12 
	1.5.2 服务器的选型 12 
	1.5.3 机房的选择 13 

### 第2 章 认识Ubuntu Server 14 

	2.1 Ubuntu 的前世今生 14 
	2.2 安装Ubuntu Server 15 
	2.2.1 安装前的准备 15 
	2.2.2 安装Ubuntu Server 15 
	2.2.3 把语言环境变量改为英文 31 
	2.2.4 安全补丁、版本升级 33 
	2.2.5 安装SSH 33 
	2.2.6 sudo 免密码 33 
	2.3 Ubuntu 快速入门指南 34 
	2.3.1 nano 编辑器 34 
	2.3.2 强大的“资源管理器”：mc 35 
	2.3.3 快速查找文件 36 
	2.3.4 软件包管理 36 
	2.3.5 使用apt 工具 38 
	2.3.6 写给CentOS 用户 47 
	2.3.7 Ubuntu 网络配置 50 
	2.3.8 远程管理Ubuntu Server 54 
	2.3.9 手工更新系统：apt-get update && apt-get upgrade 55 
	2.3.10 让系统自动更新 56 

## 第2 篇 LAMP 服务器 


### 第3 章 用Apache 做Web 服务器 58 

	3.1 Apache 简介 59 
	3.2 Apache 的安装、配置 59 
	3.2.1 Apache 的安装 59 
	3.2.2 Apache 的配置 60 
	3.2.3 Apache 虚拟主机 63 
	3.3 Apache 性能优化 73 
	3.3.1 选择正确的MPM 模块 73 
	3.3.2 优化Apache 配置 74 
	3.3.3 使用反向代理 80 
	3.4 Apache 压力测试（ab） 80 
	3.5 Apache 安全 82 
	3.5.1 安全更新 82 
	3.5.2 隐藏敏感信息 83 
	3.5.3 不要以root 身份运行Apache 84 
	3.5.4 密码认证 85 
	3.5.5 检查文件权限 87 
	3.5.6 关闭不用的模块 88 
	3.5.7 DDoS 攻击防范 88 
	3.6 Apache 日志分析 91 
	3.6.1 用Webalizer 分析Apache 日志 91 
	3.6.2 用AWStats 分析Apache 日志 93 
	3.6.3 Apache 日志合并 97 

### 第4 章 LAMP 服务器之PHP 篇 99 

	4.1 MariaDB、MySQL 简介 99 
	4.2 PHP 简介 101 
	4.3 安装LAMP 相关软件包 102 
	4.3.1 LAMP 软件包安装 102 
	4.3.2 LAMP 软件包卸载 103 
	4.4 配置Apache、MySQL、PHP 104 
	4.4.1 MariaDB 配置 104 
	4.4.2 PHP 配置 106 
	4.5 Apache、MariaDB、PHP之间的关联 107 
	4.6 用phpMyAdmin 管理MariaDB 数据库 108 
	4.6.1 phpMyAdmin 的安装 108 
	4.6.2 phpMyAdmin 排错 109 
	4.7 实例：用WordPress快速架设Blog 网站 110 
	4.7.1 WordPress 是什么 110 
	4.7.2 获取WordPress 110 
	4.7.3 为WordPress 创建MariaDB 数据库和用户 111 
	4.7.4 为WordPress 配置PHP 112 
	4.7.5 为WordPress 配置Apache 112 
	4.7.6 安装WordPress 113 

### 第5 章 LAMP 服务器之Perl 篇 114 

	5.1 安装Perl 模块 114 
	5.2 配置cgi-bin 目录 114 
	5.3 Perl 程序测试 115 
	5.4 用Perl 访问MariaDB数据库 115 
	5.5 CGI 排错 117 
	5.6 实例：用TWiki 架设Wiki 118 
	5.6.1 安装TWiki 118 
	5.6.2 配置TWiki 123 

### 第6 章 LAMP 服务器之Python 篇 125 

	6.1 安装mod_python 125 
	6.2 配置Apache 125 
	6.2.1 PSP Handler 125 
	6.2.2 Publisher Handler 126 
	6.3 让Python 支持MySQL/MariaDB 127 
	6.3.1 Python 连接MariaDB数据库测试 127 
	6.3.2 Python 的CGI 程序 128 
	6.3.3 CGI 排错 129 
	6.4 实例：用Django 开发Web应用程序 130 
	6.4.1 安装Django 130 
	6.4.2 创建自己的Django 项目 130 
	6.4.3 运行Django 开发服务器 130 
	6.4.4 连接MariaDB 数据库 131 
	6.4.5 后续开发步骤 133 
	6.5 实例：用MoinMoin 实现Wiki 133 
	6.5.1 安装MoinMoin 134 
	6.5.2 创建MoinMoin 实例 134 
	6.5.3 MoinMoin 权限控制 136 
	6.6 Python Web 应用的性能优化 137 
	6.6.1 mod-wsgi 介绍 137 
	6.6.2 mod-wsgi 支持的程序 139 
	6.6.3 mod-wsgi 的安装 139 
	6.6.4 测试 139 

### 第7 章 Apache Tomcat 架设 140 

	7.1 安装Tomcat 140 
	7.1.1 安装Tomcat 等软件 140 
	7.1.2 编程测试 141 
	7.2 配置Tomcat 141 
	7.3 Tomcat 和Apache 的整合：mod_jk 142 
	7.3.1 mod_jk 的安装 143 
	7.3.2 mod_jk 的配置 143 
	7.3.3 安装Tomcat 示例 144 
	7.3.4 阅读Tomcat 文档 145 
	7.4 Tomcat 安全 145 
	7.4.1 保护shutdown 端口 145 
	7.4.2 修改默认错误页面 145 
	7.4.3 删除样例文件 146 
	7.4.4 Manager WebApp 安全 146 

### 第8 章 最佳代理服务器：Squid 147 

	8.1 Squid 安装 147 
	8.2 为Squid 配置主机名 147 
	8.3 访问控制列表 148 
	8.4 正向代理 149 
	8.4.1 设置端口号 150 
	8.4.2 禁止某些IP 地址上网 150 
	8.4.3 禁止在某时间段上网 150 
	8.4.4 个别网站的控制 151 
	8.4.5 用NCSA 做密码认证 152 
	8.4.6 透明代理的设置 153 
	8.5 Squid 排错 157 
	8.5.1 Squid 运行状态检查 157 
	8.5.2 Squid 日志文件 157 
	8.6 用SquidGuard 过滤网站 157 
	8.6.1 SquidGuard 能做什么 157 
	8.6.2 安装SquidGuard 159 
	8.6.3 SquidGuard 基本配置 160 
	8.6.4 SquidGuard 高级配置 165 

## 第3 篇 Mail 服务器 


### 第9 章 最佳邮件服务器方案 170 

	9.1 安装所有相关软件 171 
	9.1.1 安装服务器软件 172 
	9.1.2 安装内容过滤软件 173 
	9.1.3 安装其他软件 173 
	9.2 为Postfix 准备数据库 174 
	9.2.1 创建数据库maildb 174 
	9.2.2 为数据库maildb 创建数据表 174 
	9.3 配置Postfix 177 
	9.3.1 Postfix 与MariaDB 的关联配置 177 
	9.3.2 让Postfix 使用Dovecot分发邮件 181 
	9.4 配置Dovecot 181 
	9.4.1 配置Dovecot 181 
	9.4.2 连接数据库 183 
	9.4.3 修改配置文件权限 184 
	9.4.4 重新启动Dovecot 184 
	9.5 用Telnet 进行SMTP/POP3/IMAP 测试 184 
	9.5.1 SMTP 测试 185 
	9.5.2 测试POP3 187 
	9.5.3 测试IMAP 189 
	9.6 用Thunderbird 进行SMTP/POP3/IMAP 测试 191 
	9.6.1 修改hosts 文件 191 
	9.6.2 在Thunderbird 中创建账号 191 
	9.6.3 在Thunderbird 中收取邮件 192 
	9.6.4 在Thunderbird 中发送邮件 192 
	9.7 实现SMTP 认证 194 
	9.7.1 生成安全证书 194 
	9.7.2 配置Postfix 194 
	9.7.3 用Telnet 测试SMTP认证 195 
	9.7.4 用OpenSSL 测试SMTP 认证 196 
	9.7.5 用Thunderbird 测试SMTP 认证 197 
	9.8 让用户统一使用TLS 197 
	9.9 用Dovecot 实现quota（磁盘限额） 197 
	9.9.1 启用quota 插件 197 
	9.9.2 设置quota 大小 198 
	9.10 垃圾邮件、病毒过滤 199 
	9.10.1 配置SpamAssassin 199 
	9.10.2 配置AMaViSd 200 
	9.10.3 配置Postfix，将邮件交给AMaViSd 过滤 204 
	9.10.4 垃圾邮件测试 206 
	9.10.5 非法附件测试 206 
	9.11 Postfix 的反垃圾邮件设置 207 
	9.11.1 客户端限制 207 
	9.11.2 helo 指令限制 209 
	9.11.3 发件人限制 209 
	9.11.4 收件人限制 210 
	9.11.5 邮件内容限制 210 
	9.11.6 防僵尸网络 210 
	9.12 防止被当成垃圾邮件 212 
	9.12.1 用DKIM 做域名标识 212 
	9.12.2 为DNS 添加SPF 记录 215 
	9.13 Webmail 的实现 216 
	9.13.1 安装RoundCube 216 
	9.13.2 让Apache 支持RoundCube 217 
	9.13.3 配置RoundCube 217 
	9.13.4 访问Webmail 218 
	9.14 修改系统别名/etc/aliases 218 

### 第10 章 最佳邮件列表：Mailman 220 

	10.1 安装Mailman 220 
	10.2 配置Mailman 221 
	10.2.1 修改hosts 文件 221 
	10.2.2 配置Apache 222 
	10.2.3 配置Postfix 223 
	10.2.4 配置Mailman 224 
	10.2.5 创建默认邮件列表 224 
	10.3 管理Mailman 225 
	10.3.1 通过Web 管理Mailman 225 
	10.3.2 通过命令行管理Mailman 226 
	10.4 普通用户的Web 界面 229 

## 第4 篇 文件服务器 


### 第11 章 最佳FTP 服务器方案 232 

	11.1 要实现的功能 232 
	11.2 FTP 服务器的选择 233 
	11.2.1 淘汰标准一：安全 233 
	11.2.2 淘汰标准二：易用性 234 
	11.3 Pure-FTPd 的安装、配置 234 
	11.3.1 安装Pure-FTPd 234 
	11.3.2 配置Pure-FTPd 234 
	11.4 实现FTP 用户的Web 管理 237 
	11.4.1 安装User manager for PureFTPd 238 
	11.4.2 配置User manager for PureFTPd 238 
	11.4.3 设置User manager for PureFTPd 管理员 239 
	11.4.4 Web 管理界面 239 
	11.5 Pure-FTPd 配置选项介绍 240 
	11.5.1 逻辑型配置选项 241 
	11.5.2 数值型配置选项 242 
	11.5.3 字符串型配置选项 243 
	11.5.4 IP 地址型配置选项 243 
	11.5.5 文件型配置选项 243 
	11.6 实现TLS 认证 244 
	11.6.1 证书设置 244 
	11.6.2 服务器的TLS 设置 244 
	11.6.3 FTP 客户端的TLS设置 244 
	11.7 FXP 协议支持 245 
	11.8 允许匿名访问 246 
	11.8.1 Pure-FTPd 设置 246 
	11.8.2 添加系统用户 246 

### 第12 章 云存储的鼻祖：NFS 247 

	12.1 安装前须知 248 
	12.1.1 用户权限 248 
	12.1.2 组权限 248 
	12.2 NFS 服务器的安装及配置 248 
	12.2.1 /etc/hosts 配置 249 
	12.2.2 安装NFS 服务器软件 249 
	12.2.3 RpcBind 安全 249 
	12.2.4 NIS 服务器配置 250 
	12.2.5 NFS 服务器配置 252 
	12.3 NFS 客户端的安装及配置 253 
	12.3.1 /etc/hosts 配置 253 
	12.3.2 安装NFS 客户端 254 
	12.3.3 配置NFS 客户端 254 

### 第13 章 与Windows 共舞：Samba 256 

	13.1 Samba 的好处 256 
	13.1.1 高性能 256 
	13.1.2 省钱 257 
	13.2 安装Samba 并测试 257 
	13.2.1 安装Samba 257 
	13.2.2 在Windows 客户端上测试 257 
	13.3 Samba 配置 258 
	13.3.1 最简单的Samba 配置 258 
	13.3.2 Samba 的安全认证 260 
	13.3.3 共享权限控制 261 
	13.3.4 文件的写入 261 
	13.4 基本的家目录共享方案 263 
	13.4.1 创建私人目录 263 
	13.4.2 创建新用户 264 
	13.4.3 配置Samba 265 
	13.5 其他共享方案 268 
	13.5.1 共享光驱 268 
	13.5.2 小组共享 269 

## 第5 篇 DNS 和DHCP服务器 


### 第14 章 最佳DNS 服务器：Bind9 272 

	14.1 安装Bind9 272 
	14.2 Bind9 的几种角色 273 
	14.3 配置Bind9 273 
	14.3.1 Bind9 配置文件介绍 273 
	14.3.2 DNS 记录类型 273 
	14.3.3 DNS 缓存服务器的配置 274 
	14.3.4 主DNS 服务器的配置 276 
	14.3.5 从DNS 服务器的配置 279 
	14.4 Bind9 安全 282 
	14.5 Bind9 排错 282 
	14.5.1 DNS 测试 282 
	14.5.2 日志文件 284 

### 第15 章 DNS 轮询 285 

	15.1 为什么要用DNS 轮询 285 
	15.2 DNS 轮询是怎样工作的 285 
	15.3 DNS 轮询的实现方法 285 
	15.3.1 多个CNAMES 的方法（Bind4、Bind8） 285 
	15.3.2 多个 A 记录的方法（Bind9） 286 
	15.4 DNS 轮询的测试 286 
	15.5 DNS 轮询的缺陷 287 

### 第16 章 最佳DHCP 服务器方案 288 

	16.1 DHCP 的好处 288 
	16.2 DHCP 提供信息的方法 289 
	16.3 安装DHCP 服务器软件 289 
	16.4 配置DHCP 服务器 289 
	16.4.1 网络环境介绍 289 
	16.4.2 DHCP 配置 290 
	16.4.3 测试 291 
	16.5 DHCP 排错 292 

## 第6 篇 云计算基础一：虚拟化 


### 第17 章 最佳虚拟环境：KVM 294 

	17.1 KVM 简介 294 
	17.2 Libvirt 简介 295 
	17.3 检查CPU 是否支持虚拟化 295 
	17.4 安装软件包 296 
	17.4.1 安装服务端软件包 296 
	17.4.2 安装用户端软件包 296 
	17.5 创建虚拟机 296 
	17.5.1 准备虚拟网卡 296 
	17.5.2 创建虚拟机 298 
	17.6 管理虚拟机 299 
	17.6.1 启动虚拟机 299 
	17.6.2 重启、关机 300 
	17.6.3 保存、恢复状态 300 
	17.6.4 挂起、恢复 300 
	17.6.5 空间扩容 301 
	17.6.6 增加CPU 个数 302 
	17.6.7 升级内存 304 
	17.7 克隆虚拟机 305 
	17.8 虚拟机镜像管理 307 
	17.9 迁移虚拟机 308 
	17.9.1 用NFS 共享存储 308 
	17.9.2 让目标服务器监听网络 309 
	17.9.3 迁移虚拟机 310 
	17.10 删除虚拟机 311 

### 第18 章 最佳虚拟容器：LXC 312 

	18.1 LXC 简介 312 
	18.2 安装LXC 313 
	18.3 基本用法 313 
	18.3.1 特权模式基本用法 313 
	18.3.2 非特权模式基本用法 319 
	18.3.3 全局配置文件 321 
	18.4 克隆LXC 容器 321 
	18.4.1 拷贝和快照 321 
	18.4.2 创建拷贝和快照 322 
	18.4.3 快照命令 323 
	18.4.4 临时快照 324 
	18.5 LXC 的网络 324 
	18.5.1 使用固定IP 324 
	18.5.2 让外界可以访问容器 325 
	18.6 LXC 的后台 326 
	18.6.1 后台服务 326 
	18.6.2 后台存储 327 
	18.7 容器安全 327 
	18.7.1 Linux 功能过滤 327 
	18.7.2 内存限制 328 
	18.7.3 apparmor 328 
	18.7.4 SELinux 329 
	18.7.5 Seccomp 329 

## 第7 篇 云计算基础二：高可用与负载均衡 


### 第19 章 负载均衡、高可用的Web 集群 332 

	19.1 介绍 332 
	19.1.1 HAProxy 介绍 332 
	19.1.2 Keepalived 介绍 333 
	19.1.3 HAProxy+Keepalived的好处 333 
	19.2 架构 333 
	19.2.1 架构详情 334 
	19.2.2 架构图 334 
	19.3 架构的实现 335 
	19.3.1 Web 服务器的安装及配置 335 
	19.3.2 Keepalived 的安装及配置 336 
	19.3.3 HAProxy 的安装及配置 340 
	19.4 测试 341 
	19.4.1 Web 节点故障模拟 341 
	19.4.2 负载均衡节点故障模拟 342 
	19.5 HAProxy 的Web 统计页面 342 
	19.6 文件的同步 343 
	19.6.1 安装unison 343 
	19.6.2 创建密钥 344 
	19.6.3 手工同步 345 
	19.6.4 自动同步 347 
	19.6.5 多台主机的同步 348 

### 第20 章 负载均衡、高可用的MariaDB 数据库集群 351 

	20.1 MariaDB Galera 集群介绍 351 
	20.1.1 关于Galera 复制 352 
	20.1.2 MariaDB Galera 集群的特点 353 
	20.1.3 本例中的服务器 354 
	20.2 创建高可用集群 354 
	20.2.1 安装MariaDB Galera软件包 354 
	20.2.2 设置 Galera 355 
	20.2.3 启动Galera 集群 356 
	20.2.4 写入测试 357 
	20.2.5 故障模拟 358 
	20.3 负载均衡 359 
	20.3.1 创建MariaDB 用户 360 
	20.3.2 安装数据库客户端 361 
	20.3.3 安装配置Keepalived 361 
	20.3.4 安装配置HAProxy 362 
	20.4 数据备份与恢复 363 
	20.4.1 安装xtrabackup 363 
	20.4.2 xtrabackup 配置 364 
	20.4.3 全备份 365 
	20.4.4 增量备份 365 
	20.4.5 恢复 368 
	20.4.6 自动备份 369 

## 第8 篇 远程控制与监控 


### 第21 章 最佳远程控制方案：SSH 374 

	21.1 关于公钥认证 374 
	21.1.1 为什么要用公钥认证 374 
	21.1.2 公钥认证是怎么工作的 375 
	21.2 SSH 的安装 375 
	21.2.1 安装SSH 服务器和客户端 375 
	21.2.2 测试 375 
	21.3 SSH 配置 376 
	21.3.1 生成密钥对 376 
	21.3.2 将公钥复制到服务器 376 
	21.3.3 SSH 登录测试 377 
	21.3.4 SSH 服务器配置 379 
	21.4 用端口敲门隐藏SSH服务 379 
	21.4.1 端口敲门的工作原理 380 
	21.4.2 准备防火墙 380 
	21.4.3 安装knockd 380 
	21.4.4 配置knockd 380 
	21.4.5 测试敲门服务 381 
	21.5 SSH 小技巧 382 
	21.5.1 用scp 远程复制文件 382 
	21.5.2 用sftp 远程传输文件 383 
	21.5.3 在客户端上指定命令 383 
	21.5.4 在服务器上限制所执行的命令 384 
	21.5.5 修改密钥口令 384 
	21.5.6 将密钥放入内存 385 

### 第22 章 最佳监控方案：Nagios 386 

	22.1 Nagios 介绍 386 
	22.2 安装Nagios 387 
	22.3 Nagios 的一般配置 387 
	22.3.1 Nagios 初始化设置 387 
	22.3.2 Nagios 监控设置 388 
	22.4 用NRPE 进行远程监控 397 
	22.4.1 设置被监控的主机 397 
	22.4.2 设置Nagios 服务器 398 
	22.5 MariaDB 数据库监控 399 
	22.5.1 添加主机 399 
	22.5.2 创建主机组 399 
	22.5.3 设置对数据库组的监控 400 
	22.5.4 创建数据库用户 400 
	22.5.5 重启Nagios 服务 400 
	22.6 手机短信提醒 401 
	22.7 Nagios 排错 401 

## 第9 篇 数据安全 


### 第23 章 最佳RAID 方案：RAID10 404 

	23.1 RAID 方案的选择 404 
	23.2 RAID10 方案介绍 406 
	23.3 创建RAID 物理卷 407 
	23.3.1 第一块硬盘的分区 407 
	23.3.2 其他硬盘的分区 410 
	23.4 软件RAID 设置 411 
	23.4.1 创建/boot 分区 411 
	23.4.2 创建根分区和swap分区 413 
	23.5 分区格式化 414 
	23.5.1 格式化/boot 分区 414 
	23.5.2 格式化根分区 415 
	23.5.3 格式化交换分区 416 
	23.6 保存分区设置 416 
	23.7 grub 的问题 417 
	23.8 RAID10 的日常维护 418 
	23.8.1 mdadm 的主要工作模式 418 
	23.8.2 mdadm 的选项 418 
	23.8.3 创建RAID 阵列 420 
	23.8.4 查询RAID 阵列 420 
	23.8.5 RAID 的监控 421 
	23.8.6 RAID 的启动/停止 421 
	23.9 故障处理 421 
	23.9.1 从RAID 中移除设备 422 
	23.9.2 添加已有RAID 物理卷 422 
	23.9.3 更换全新硬盘 423 
	23.10 添加备用硬盘 425 
	23.10.1 插入新硬盘 426 
	23.10.2 新硬盘分区 426 
	23.10.3 将新分区加入RAID 426 
	23.10.4 设置grub 427 
	23.10.5 故障模拟 427 
	23.11 RAID10 的空间扩展 428 

### 第24 章 最佳数据安全方案：RAID10+LVM 429 

	24.1 创建RAID 物理卷 429 
	24.1.1 将第一块硬盘分区 429 
	24.1.2 剩余硬盘的分区处理 430 
	24.2 软件RAID 设置 430 
	24.2.1 创建RAID1 阵列 431 
	24.2.2 创建RAID10 阵列 431 
	24.3 LVM 的创建和配置 432 
	24.3.1 创建LVM 物理卷 432 
	24.3.2 LVM 配置 432 
	24.4 创建/boot 分区 433 
	24.5 LVM 的相关命令 434 
	24.5.1 LVM 物理卷相关命令 434 
	24.5.2 LVM 卷组相关命令 435 
	24.5.3 LVM 逻辑卷相关命令 438 
	24.6 添加新硬盘 440 
	24.6.1 插入新硬盘 441 
	24.6.2 配置RAID 441 
	24.6.3 在RAID 上配置LVM 442 
	24.6.4 扩容文件系统 443 
	24.7 更换硬盘 444 
	24.8 LVM 分区备份 444 
	24.8.1 创建快照 444 
	24.8.2 备份快照内容 445 
	24.8.3 删除快照 445 

## 第10 篇 系统安全 


### 第25 章 Ubuntu Server 系统安全 448 

	25.1 系统安全更新 448 
	25.1.1 订阅安全列表 448 
	25.1.2 自动更新 448 
	25.2 控制台安全 449 
	25.3 用户、密码管理 449 
	25.3.1 关于root 用户 450 
	25.3.2 关于sudo 450 
	25.3.3 关于/etc/sudoers 450 
	25.3.4 密码策略 452 
	25.4 ufw 防火墙 453 
	25.4.1 启用、禁用ufw 454 
	25.4.2 基本规则设置 455 
	25.4.3 常用规则设置 456 
	25.4.4 高级规则设置 457 
	25.4.5 IP 伪装 459 
	25.5 iptables 防火墙 461 
	25.5.1 iptables 命令 461 
	25.5.2 基本的iptables 防火墙 462 
	25.5.3 保存防火墙规则 464 
	25.6 AppArmor 配置 464 
	25.6.1 学习模式和强制模式 465 
	25.6.2 加载和禁用 466 
	25.6.3 配置文件 466 

### 第26 章 入侵检测与系统修复 468 

	26.1 psad 简介 468 
	26.2 安装psad 468 
	26.3 配置iptables 规则 469 
	26.3.1 清空规则表 469 
	26.3.2 添加规则 469 
	26.4 配置psad 471 
	26.4.1 联系人和主机名 471 
	26.4.2 危险级别 471 
	26.4.3 敏感度 471 
	26.4.4 日志位置 472 
	26.4.5 要忽略的端口 472 
	26.4.6 调整报警频率 472 
	26.4.7 重启psad 服务 472 
	26.5 扫描测试 472 
	26.6 入侵防御 473 
	26.6.1 定义来源IP 的危险级别 473 
	26.6.2 自动拦截 474 
	26.7 肉鸡检测 475 
	26.7.1 chkrootkit 的使用 476 
	26.7.2 rkhunter 的使用 477 
	26.7.3 unhide 的使用 479 
	26.8 数据完整性检测 480 
	26.8.1 安装Tripwire 481 
	26.8.2 配置Tripwire 483 
	26.8.3 初始化Tripwire 数据库 486 
	26.8.4 执行完整性检测 486 
	26.8.5 检测报告分析 487 
	26.8.6 查看Tripwire 数据库内容 488 
	26.8.7 使用Tripwire 的注意事项 489 
	26.9 被入侵后的系统恢复 490 
	26.9.1 保持冷静 490 
	26.9.2 断开网络 490 
	26.9.3 找到黑客入侵的方法 491 
	26.9.4 黑客文件清理 495 
	26.9.5 恢复未受影响的服务 495 
	26.9.6 修复问题 495 
	26.9.7 恢复受影响的服务 496 
	26.9.8 监控系统 496 